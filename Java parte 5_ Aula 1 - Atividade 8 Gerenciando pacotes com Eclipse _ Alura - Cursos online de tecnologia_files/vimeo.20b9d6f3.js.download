$(function(){var e,a,t,o,n,i,r,s,d,c,l,v=$("#video-container-data"),u=!1;function p(){return v.children("iframe").size()>0}function f(){if(!p()){$("#loading").remove();var e=$(".video-changePlayer");e.unbind("click"),e.attr("title","O player com controle de velocidade está temporariamente indisponível."),$(".settings-box-item-player").addClass("settings-box-item-player--disabled"),$(".video-changePlayer span").show(),m()}}function m(){var e,a;0==$("#vimeo-iframe").length&&(e=$(".video-changePlayer").data("uri"),(a=$('<iframe id="vimeo-iframe" class="video-js vjs-tech" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>')).attr("src",e+"?api=1"),a.hide(),v.append(a),new Vimeo.Player(document.querySelector("iframe")).on("play",y)),$("#video-player-frame").toggle(),$("#vimeo-iframe").toggle(),$("#boavista_player").toggle(),$("#loading").toggle(),videojs("video-player-frame").pause(),$("#vimeo-iframe")[0].contentWindow.postMessage('{"method":"pause","value":""}',"*")}function y(){if(!u){var e=$("#video-container-data").data("course"),a=$("#video-container-data").data("task-id"),t=$("#video-container-data").data("extra-content-id"),o={courseCode:e,videoTaskId:a};t?(new ExtraContentProgressRequest).callEndpoint(t,function(){g(),u=!0}):$.post("/course/"+e+"/task/"+a+"/mark-video",o,function(){g(),u=!0})}}function g(){var e=$(".task-menu-nav-item--selected .task-menu-nav-item-svg");if(!e.hasClass("task-menu-nav-item-svg--done")){var a=e.attr("class");e.attr("class",a+" task-menu-nav-item-svg--done")}}e=v.data("extra-content-id"),a=v.data("task-id"),t=v.data("section-id"),o=v.data("course-id"),n=v.data("course"),i=v.data("playback-rate"),r=v.data("quality"),s=v.data("gnarus-name"),d=e?"/extracontent/"+e+"/video":"/course/"+n+"/task/"+a+"/video",c=e?"extra-content-video":"course-video",l=e?"extra-content-"+e:"course-"+o+" section-"+t,$.get(d,function(e){!function(e,a){var t=$('<video id="video-player-frame" class="video-js vjs-default-skin video-player-frame video-player" controls preload="auto" poster="/images/video/vinheta-'+a+'.png"></video>');$.each(e,function(){var e=$('<source type="video/mp4">');e.attr("src",this.link),e.attr("data-res",this.quality),t.append(e)}),p()&&t.hide(),v.append(t)}(e,s),function(e,a,t,o){function n(){var t=this.playbackRate();$.post("/user/profile/setPlaybackRate",{rate:t}),ga("send","event",{eventCategory:e,eventAction:"ratechange",eventLabel:a,eventValue:t,nonInteraction:!0})}HDtoggle("video-player-frame",o),videojs("video-player-frame",{playbackRates:[.7,.8,1,1.2,1.5,2,2.5,3],plugins:{HD:{},ga:{eventCategory:e,eventLabel:a}}},function(){this.ga(),this.on("ratechange",n),this.on("error",f),this.on("play",y)}).ready(function(){this.playbackRate(t)})}(c,l,i,r),$("#loading").remove(),$("#video-player-frame").bind("contextmenu",function(){return!1}),v.hasClass("custom-player")&&$("#video-player-frame").remove()}).fail(f),$(".video-changePlayer").on("click",function(){$.post("/user/profile/setPlayer").success(function(){m()})}),"CUSTOM"!=$("#videoPreferences-player").val()&&m(),$(window).keypress(function(e){if(32==e.which&&!$(".skipKeyPress").is(":focus")){var a=document.querySelector("video");a&&(e.preventDefault(),a&&1==a.paused?a.play():a.pause())}})});